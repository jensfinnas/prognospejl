function getChartData(t,e,a){return t.filter(function(t){return t.date>=a}).map(function(t){return t.value=t[e],t})}function getForecastData(t,e,a){var r=t.filter(function(t){return t.name==e&&""!=t[a]}).map(function(t){return t.value=t[a],t});return d3.nest().key(function(t){return t.date}).entries(r).sort(function(t,e){return t.values[0].date-e.values[0].date})}function floatFromString(t){return+t.replace(",",".")}function extend(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t}function chain(t,e){return t?function(){t.call(this,arguments),e.call(this,arguments)}:e}LineChart=function(){function t(t,e,a){var r=this;r.container=d3.select(t),r.tooltipId=t.replace("#","")+"-tip",defaultOpts={tooltipContent:function(t){return t},yAxisTitle:"value",interpolate:"linear"},r.opts=extend(defaultOpts,a),r.data=e,r.drawChart(),console.log(r.data);var n=d3.select(window).on("resize"),o=chain(n,function(){r.resize()});d3.select(window).on("resize",o)}function e(t,e){return t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()}return t.prototype.drawChart=function(){var t=this,e=t.container[0][0].offsetWidth;t.margins=m={top:.02*e,right:.05*e,bottom:.1*e,left:Math.max(.12*e,50)},t.width=w=e-m.left-m.right,t.height=h=.5*w,t.pointRadius=.012*e,t.clickablePointRadius=w/(t.data.length-1)/2;var a=function(t){t=t||1;var a=11;return Math.max(a,t*e*.025)+"px"};t.svg=t.container.append("svg").attr("width",w+m.left+m.right).attr("height",h+m.top+m.bottom).attr("class","linechart"),t.chart=t.svg.append("g").attr("transform","translate("+m.left+", "+m.top+")"),t.x=d3.time.scale().range([0,w]).domain(d3.extent(t.data,function(t){return t.date})),t.y=d3.scale.linear().range([h,0]).domain([d3.min(t.data,function(t){return t.value}),5]),t.line=d3.svg.line().x(function(e){return t.x(e.date)}).y(function(e){return t.y(e.value)}).interpolate(t.opts.interpolate);var r=d3.svg.axis().scale(t.y).orient("left").tickSize(-w).ticks(5),n=d3.svg.axis().scale(t.x).orient("bottom").ticks(10);t.tooltip=d3.tip().attr("class","d3-tip linechart-tip").attr("id",t.tooltipId).html(t.opts.tooltipContent).offset([t.clickablePointRadius-t.pointRadius-10,0]),t.chart.call(t.tooltip);var o=t.chart.append("g").attr("class","y axis").call(r);o.append("text").attr("class","title").attr("transform","rotate(-90)").attr("x",-h/2).attr("y",.9*-m.left).attr("dy",".7em").style("text-anchor","middle").attr("font-size",a(1.2)).text(t.opts.yAxisTitle),o.selectAll(".tick text").attr("x",-6).attr("font-size",a());t.chart.append("g").attr("class","x axis").attr("transform","translate(0,"+t.height+")").call(n);t.chart.append("path").datum(t.data).attr("class","line actual").attr("d",t.line)},t.prototype.addForecast=function(t){var e=this;d3.scale.linear().domain([0,2]).range(["green","red"]);e.forecastLine=d3.svg.line().x(function(t){return e.x(t.forecastDate)}).y(function(t){return e.y(t.value)}),e.forecastGroup=e.chart.selectAll("g.forecast-group").data(t).enter().append("g").attr("class","forecast-group hidden"),console.log(t),e.forecastGroup.append("path").datum(function(t){return e._getActual(t.values[0].date).concat(t.values)}).attr("class","forecast line").attr("d",e.forecastLine);var a=e.forecastGroup.selectAll("g.forecast-error").data(function(t){return t.values.map(function(t){var a=e._getActual(t.forecastDate);return t.actual=a.length?a[0].value:null,t.error=t.value-t.actual,t})}).enter().append("g").attr("class","forecast-error-group").attr("transform",function(t){var a=e.x(t.forecastDate),r=e.y(t.value);return"translate("+a+", "+r+")"});a.append("line").attr("class","forecast-error line").attr("x1",0).attr("x2",0).attr("y1",0).attr("y2",function(t){return e.y(t.actual)-e.y(t.value)}).attr("stroke",function(t){return t.error>0?"green":"red"}),a.append("text").text(function(t){return formatNumber(t.error)+" %-enh. fel"}).attr("dy",".35em").attr("x",5)},t.prototype.showForecast=function(t){var a=this;a.forecastGroup.classed("hidden",function(a){return!e(t,a.values[0].date)})},t.prototype.resize=function(){var t=this;t.svg.remove(),d3.select("#"+t.tooltipId).remove(),t.drawChart()},t.prototype._getActual=function(t){var a=this;return a.data.filter(function(a){return e(a.date,t)}).map(function(e){return e.forecastDate=new Date(e.date.getFullYear(),t.getMonth(),1),e})},t}();var locale=d3.locale({decimal:",",thousands:" ",grouping:[3],currency:["","SEK"],dateTime:"%A den %d %B %Y %X",date:"%Y-%m-%d",time:"%H:%M:%S",periods:["fm","em"],days:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"],shortDays:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],shortMonths:["Jan","Feb","Mar","Apr","Maj","Jun","Jul","Aug","Sep","Okt","Nov","Dec"]}),formatNumber=locale.numberFormat(".1f"),parseDate=d3.time.format("%Y-%m-%d").parse;